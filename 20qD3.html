<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="//d3js.org/d3.v3.min.js"></script>
</head>

<style>
	.parag {
		font-family: sans-serif;
		font-size: 18px;
	}

	#visualization {
		font-size: 16px;
	}
	
</style>
	
<body>

	<p id="question" class = "parag"></p> 
	
	<div>
		<button class="button" onClick = "yesResponse()" id="yesButton">Yes</button>
		<button class="button"  onClick = "noResponse()" id="noButton">No</button>
	</div>
	
	<p id= "answer" class = "parag"></p>
	
	<div id="possibilities"> </div>
	<div id="incorrect"> </div>
	
	
	<script>
	
	//DOG, CAT, HAMSTER, BIRD, BEAR, GIRAFFE, HORSE, COW
	
	
	//set up tree
	var qas = [];

	d3.csv("20qtree.csv", function(data) {
		//put data into array
  		for(i = 0; i<data.length;i++){
  			qas.push(data[i].questions);
  		}
  		document.getElementById("question").innerHTML = qas[index];
	});

	
	//set up visualization
	var header; //= ["big","cage","grass","meow","chirp","long neck","moo"];
	var animals;
	var index = 0;
	
	//import data
	d3.json("20qanimals.json", function(error, data){
		animals = data.animals;
		header = data.header;
		//add index, provenWrong, and onSymptom to animal data
		for(i=0; i<animals.length; i++){
			animals[i].index = i;
			animals[i].provenWrong = false;
			animals[i].onSymptom = 0;
		}
	
	//create SVG container			
	var svg1 = d3.select("#possibilities").append("svg")
		.attr("width",400)
		.attr("height",200);
	
	var svg2 = d3.select("#incorrect").append("svg")
		.attr("width", 400)
		.attr("height",200);
	//create name elements	
	svg1.selectAll("g")
	.data(animals)
		.enter()
		.append('g')
			.attr("id", function(d) {return d.name})
			.append("text")
				.attr("x", function(d) { return 10; })
				.attr("y", function(d) { return 15 + (d.index*20); })
				.text( function (d) { 
					if(!d.provenWrong) {return d.name + ":"} 
					else {return ""}
					;})
				.attr("font-family", "sans-serif")
				.attr("font-size", "14px")
				.attr("fill", "black");
		//create symptom elements
		for(i=0; i<animals[0].code.length; i++){
			svg1.selectAll('g')	
				.append('text')
					.attr("class", function() {return header[i]})
					.attr("x", function(d) {return 100 + (d.onSymptom*100)})
					.attr("y", function(d) {return 15 + (d.index*20); })
					.text( function (d) {
						if(d.code[i] == 0) {return ""}
						if(d.code[i] == 1) {d.onSymptom++; return header[i]}
						if(d.code[i] == -1){d.onSymptom++; return "not " + header[i]}
					;})
					.attr("font-family", "sans-serif")
					.attr("font-size", "14px")
					.attr("fill", "black");
		}
	});
	
	function yesResponse() {
		// update visualization
		d3.select("#possibilities").select("svg").selectAll("g")
				.selectAll("."+ header[index])

				.attr( "fill", function (d) {
					if(d.code[index] == 1) {return "green"}
					if(d.code[index] == -1){d.provenWrong = true; return "red"}
		;})
		
		for(i=0;i<animals.length;i++){
			if(animals[i].provenWrong){
				d3.select("#possibilities").select("svg").select("#" + animals[i].name)
					.remove();
			}
		}
		

		//update visualization
		

		index = index*2 + 2;

		if (index < (qas.length-1)/2) { //where answers start
			document.getElementById("question").innerHTML = qas[index];
		}
		else {
			document.getElementById("question").innerHTML = "";
			//show answer
			document.getElementById("answer").innerHTML = "<strong>" + qas[index] + "</strong>";
  		    document.getElementById("yesButton").disabled = true;
  		    document.getElementById("noButton").disabled = true;
		}
	}
	
	function noResponse() {
		//update visualization
		d3.select("#possibilities").select("svg").selectAll("g")
				.selectAll("." + header[index])
				.attr( "fill", function (d) {
					if(d.code[index] == 1) {d.provenWrong = true; return "red"}
					if(d.code[index] == -1){return "green"}
		;})
		
		for(i=0;i<animals.length;i++){
			if(animals[i].provenWrong){
				d3.select("#possibilities").select("svg").select("#" + animals[i].name)
					.remove();
			}
		}
	
		//update questions/answer
		index = index*2 + 1;
		
		if (index < (qas.length-1) /2) { //where answers start
			document.getElementById("question").innerHTML = qas[index];
		}
		else {
			document.getElementById("question").innerHTML = "";
			//show answer
			document.getElementById("answer").innerHTML = "<strong>" + qas[index] + "</strong>";
  		    document.getElementById("yesButton").disabled = true;
  		    document.getElementById("noButton").disabled = true;
		}
	}


</script>
</html>
